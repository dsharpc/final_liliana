{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\nimport numpy as np","user":"anonymous","dateUpdated":"2018-05-21T20:06:57+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933013458_-1223039443","id":"20180521-200333_295405572","dateCreated":"2018-05-21T20:03:33+0000","dateStarted":"2018-05-21T20:06:57+0000","dateFinished":"2018-05-21T20:06:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2883"},{"text":"%pyspark\ndefun = spark.read.csv('s3://daniel-sharp/decesos/defun_2016.csv', header =True) \ncausas = spark.read.csv('s3://daniel-sharp/decesos/decatcausa.csv', header =True) \nestados = spark.read.csv('s3://daniel-sharp/decesos/decateml.CSV', header =True) \ngenero = spark.read.csv('s3://daniel-sharp/decesos/desexo.csv', header =True) \nedad = spark.read.csv('s3://daniel-sharp/decesos/deedad.csv', header =True) \nescolaridad = spark.read.csv('s3://daniel-sharp/decesos/deesco.csv', header =True) ","user":"anonymous","dateUpdated":"2018-05-21T20:09:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933076535_-694501723","id":"20180521-200436_1561517590","dateCreated":"2018-05-21T20:04:36+0000","dateStarted":"2018-05-21T20:09:11+0000","dateFinished":"2018-05-21T20:09:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2884"},{"text":"%pyspark\nfor colum in defun.columns:\n    defun = defun.withColumn(colum, regexp_replace(colum, '\\t', ''))\n    \nnumerics = ['anio_ocur','horas','anio_nacim']\n\nfor colum in numerics:\n    defun = defun.withColumn(colum, col(colum).cast(\"double\"))","user":"anonymous","dateUpdated":"2018-05-21T20:09:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933351591_1504548967","id":"20180521-200911_368689157","dateCreated":"2018-05-21T20:09:11+0000","dateStarted":"2018-05-21T20:09:37+0000","dateFinished":"2018-05-21T20:09:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2885"},{"text":"%pyspark\nestados = estados.withColumn('cve_ent', regexp_replace('cve_ent', '\\t', ''))\\\n.withColumn('cve_mun', regexp_replace('cve_mun', '\\t', '')).filter('cve_mun == 000')","user":"anonymous","dateUpdated":"2018-05-21T20:09:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933377117_651792162","id":"20180521-200937_1520258267","dateCreated":"2018-05-21T20:09:37+0000","dateStarted":"2018-05-21T20:09:46+0000","dateFinished":"2018-05-21T20:09:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2886"},{"text":"%pyspark\ndefun_base = defun.alias('a').join(escolaridad.alias('b'), col('a.escolarida') == col('b.CVE'))\\\n.withColumn('edad', defun.anio_ocur - defun.anio_nacim)\\\n.filter('edad < 300').filter('edad > 0').filter('horas < 24').filter('escolarida < 24')\\\n.withColumn('id', monotonically_increasing_id())\\\n.withColumn(\"anios_edu\", col(\"anios_edu\").cast(\"double\"))\\\n.drop('escolarida')","user":"anonymous","dateUpdated":"2018-05-21T20:09:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933386769_1233163074","id":"20180521-200946_1836126283","dateCreated":"2018-05-21T20:09:46+0000","dateStarted":"2018-05-21T20:09:55+0000","dateFinished":"2018-05-21T20:09:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2887"},{"text":"%pyspark\nfeatures = ['edad','anios_edu']","user":"anonymous","dateUpdated":"2018-05-21T20:10:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933395806_-469350809","id":"20180521-200955_23488294","dateCreated":"2018-05-21T20:09:55+0000","dateStarted":"2018-05-21T20:10:05+0000","dateFinished":"2018-05-21T20:10:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2888"},{"text":"%pyspark\nfrom pyspark.ml.clustering import KMeans\nfrom pyspark.ml.feature import VectorAssembler, StandardScaler\nfrom pyspark.ml.evaluation import ClusteringEvaluator\nfrom pyspark.ml import Pipeline","user":"anonymous","dateUpdated":"2018-05-21T20:10:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933405585_160113716","id":"20180521-201005_1222303954","dateCreated":"2018-05-21T20:10:05+0000","dateStarted":"2018-05-21T20:10:14+0000","dateFinished":"2018-05-21T20:10:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2889"},{"text":"%pyspark\nscaler = StandardScaler(inputCol='grouped_features', outputCol= 'features', withMean=True)\nassembler = VectorAssembler(inputCols = features, outputCol = 'grouped_features')\nkmeans = KMeans(k=4, seed=1)\npipe = Pipeline(stages = [assembler, scaler, kmeans])","user":"anonymous","dateUpdated":"2018-05-21T20:10:24+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933414140_533735547","id":"20180521-201014_1474361926","dateCreated":"2018-05-21T20:10:14+0000","dateStarted":"2018-05-21T20:10:24+0000","dateFinished":"2018-05-21T20:10:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2890"},{"text":"%pyspark\nmodel = pipe.fit(defun_base).transform(defun_base)","user":"anonymous","dateUpdated":"2018-05-21T20:10:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933424338_1372704332","id":"20180521-201024_66821954","dateCreated":"2018-05-21T20:10:24+0000","dateStarted":"2018-05-21T20:10:33+0000","dateFinished":"2018-05-21T20:11:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2891"},{"text":"%pyspark\nevaluator = ClusteringEvaluator()\nevaluator.evaluate(model)","user":"anonymous","dateUpdated":"2018-05-21T20:11:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.48939322121534573\n"}]},"apps":[],"jobName":"paragraph_1526933433646_-2122354677","id":"20180521-201033_398829075","dateCreated":"2018-05-21T20:10:33+0000","dateStarted":"2018-05-21T20:11:23+0000","dateFinished":"2018-05-21T20:11:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2892"},{"text":"%pyspark\ncount_group = model.groupBy('prediction').count()\ncount_group.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/a/', header = True)","user":"anonymous","dateUpdated":"2018-05-21T21:16:52+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933483837_1628254222","id":"20180521-201123_1913507192","dateCreated":"2018-05-21T20:11:23+0000","dateStarted":"2018-05-21T21:16:52+0000","dateFinished":"2018-05-21T21:17:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2893"},{"text":"%pyspark\nprint(\"Analisis Descriptivo para Edad\")\nana_edad = model.groupBy('prediction').agg((mean(model.edad)).alias('Promedio'),\\\n                                      (stddev(model.edad)).alias('Desviación'),\\\n                                     (max(model.edad)).alias('Máximo'),\\\n                                     (min(model.edad)).alias('Mínimo')).sort('prediction')\nana_edad.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/b/', header =True)","user":"anonymous","dateUpdated":"2018-05-21T21:18:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Analisis Descriptivo para Edad\n"}]},"apps":[],"jobName":"paragraph_1526933570880_1553718560","id":"20180521-201250_1101238564","dateCreated":"2018-05-21T20:12:50+0000","dateStarted":"2018-05-21T21:18:28+0000","dateFinished":"2018-05-21T21:18:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2894"},{"text":"%pyspark\nprint(\"Analisis Descriptivo para años de estudio\")\nana_estudio = model.groupBy('prediction').agg((mean(model.anios_edu)).alias('Promedio'),\\\n                                      (stddev(model.anios_edu)).alias('Desviación'),\\\n                                     (max(model.anios_edu)).alias('Máximo'),\\\n                                     (min(model.anios_edu)).alias('Mínimo')).sort('prediction')\nana_estudio.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/c/', header =True)","user":"anonymous","dateUpdated":"2018-05-21T21:19:51+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Analisis Descriptivo para años de estudio\n"}]},"apps":[],"jobName":"paragraph_1526933607094_-722425284","id":"20180521-201327_1793307175","dateCreated":"2018-05-21T20:13:27+0000","dateStarted":"2018-05-21T21:19:51+0000","dateFinished":"2018-05-21T21:20:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2895"},{"text":"%pyspark\ncausas_por_grupo = model.alias('a').groupBy('prediction','a.causa_def').count()\\\n.select(\"*\",dense_rank().over(Window.partitionBy('prediction').orderBy(desc('count'))).alias('rn'))\\\n.filter('rn < 6').join(causas.alias('b'), col('a.causa_def') == col('b.CVE')).drop('causa_def','CVE')\ncausas_por_grupo.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/d/', header = True)","user":"anonymous","dateUpdated":"2018-05-21T21:20:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526933968487_-364470890","id":"20180521-201928_796537542","dateCreated":"2018-05-21T20:19:28+0000","dateStarted":"2018-05-21T21:10:19+0000","dateFinished":"2018-05-21T21:10:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2896"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-05-21T21:22:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526937750152_1378617819","id":"20180521-212230_1353442825","dateCreated":"2018-05-21T21:22:30+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4468"},{"text":"%pyspark\ncausas_por_grupo.show()","user":"anonymous","dateUpdated":"2018-05-21T20:20:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----+---+--------------------+\n|prediction|count| rn|             DESCRIP|\n+----------+-----+---+--------------------+\n|         1| 6798|  1|Agresión con disp...|\n|         1| 6128|  2|Infarto agudo del...|\n|         1| 3356|  3|Cirrosis hepática...|\n|         1| 2950|  4|Lesión autoinflig...|\n|         1| 2709|  5|Otras cirrosis de...|\n|         3|26691|  1|Infarto agudo del...|\n|         3|13927|  2|Diabetes mellitus...|\n|         3|12428|  3|Diabetes mellitus...|\n|         3| 6513|  4|Otras cirrosis de...|\n|         3| 5974|  5|Diabetes mellitus...|\n|         2|14954|  1|Infarto agudo del...|\n|         2| 4967|  2|Diabetes mellitus...|\n|         2| 4816|  3|Diabetes mellitus...|\n|         2| 2642|  4|Otras cirrosis de...|\n|         2| 2549|  5|Neumonía, no espe...|\n|         0|36479|  1|Infarto agudo del...|\n|         0| 9438|  2|Diabetes mellitus...|\n|         0| 7303|  3|Enfermedad pulmon...|\n|         0| 6000|  4|Diabetes mellitus...|\n|         0| 5660|  5|Neumonía, no espe...|\n+----------+-----+---+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1526934014826_936978109","id":"20180521-202014_1448445632","dateCreated":"2018-05-21T20:20:14+0000","dateStarted":"2018-05-21T20:20:37+0000","dateFinished":"2018-05-21T20:20:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2897"},{"text":"%pyspark\ncausas_por_estado = model.alias('a').groupBy('prediction','a.ent_ocurr').count()\\\n.select(\"*\",dense_rank().over(Window.partitionBy('prediction').orderBy(desc('count'))).alias('rn'))\\\n.filter('rn < 6').join(estados.alias('b'), col('a.ent_ocurr') == col('b.cve_ent')).drop('ent_ocurr','cve_ent','cve_loc','cve_mun')\ncausas_por_estado.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/e/', header = True)","user":"anonymous","dateUpdated":"2018-05-21T21:23:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934023301_1871163762","id":"20180521-202023_1375984159","dateCreated":"2018-05-21T20:20:23+0000","dateStarted":"2018-05-21T21:23:30+0000","dateFinished":"2018-05-21T21:23:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2898"},{"text":"%pyspark\ncausas_por_estado.show()","user":"anonymous","dateUpdated":"2018-05-21T20:21:24+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----+---+--------------------+\n|prediction|count| rn|             nom_loc|\n+----------+-----+---+--------------------+\n|         1|12916|  1|              M�xico|\n|         1|11200|  2|    Ciudad de M�xico|\n|         1| 8014|  3|             Jalisco|\n|         1| 7409|  4|Veracruz de Ignac...|\n|         1| 6066|  5|          Guanajuato|\n|         3|23092|  1|              M�xico|\n|         3|22480|  2|    Ciudad de M�xico|\n|         3|16851|  3|Veracruz de Ignac...|\n|         3|14378|  4|             Jalisco|\n|         3|11099|  5|              Puebla|\n|         2|22005|  1|    Ciudad de M�xico|\n|         2|11210|  2|              M�xico|\n|         2| 7114|  3|             Jalisco|\n|         2| 6056|  4|Veracruz de Ignac...|\n|         2| 6046|  5|          Nuevo Le�n|\n|         0|18902|  1|              M�xico|\n|         0|17338|  2|Veracruz de Ignac...|\n|         0|13826|  3|    Ciudad de M�xico|\n|         0|12769|  4|             Jalisco|\n|         0|12142|  5|              Puebla|\n+----------+-----+---+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1526934071346_481127283","id":"20180521-202111_319713573","dateCreated":"2018-05-21T20:21:11+0000","dateStarted":"2018-05-21T20:21:24+0000","dateFinished":"2018-05-21T20:21:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2899"},{"text":"%pyspark\npc_mujeres = model.groupBy('prediction').agg((mean(model.sexo)-1).alias('% mujeres')).sort('prediction')\npc_mujeres.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/f/', header = True)","user":"anonymous","dateUpdated":"2018-05-21T21:24:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934084922_1791798220","id":"20180521-202124_1200969968","dateCreated":"2018-05-21T20:21:24+0000","dateStarted":"2018-05-21T21:24:44+0000","dateFinished":"2018-05-21T21:24:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2900"},{"text":"%pyspark\nprint(\"Analisis Descriptivo para Horas de Defunción\")\nana_horas = model.groupBy('prediction').agg((mean(model.horas)).alias('Promedio'),\\\n                                      (stddev(model.horas)).alias('Desviación'),\\\n                                     (max(model.horas)).alias('Máximo'),\\\n                                     (min(model.horas)).alias('Mínimo')).sort('prediction')\nana_horas.repartition(1).write.csv('s3://daniel-sharp/decesos/sparkml/g/', header = True)","user":"anonymous","dateUpdated":"2018-05-21T21:25:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Analisis Descriptivo para Horas de Defunción\n"}]},"apps":[],"jobName":"paragraph_1526934099181_-1087647224","id":"20180521-202139_915049776","dateCreated":"2018-05-21T20:21:39+0000","dateStarted":"2018-05-21T21:25:35+0000","dateFinished":"2018-05-21T21:25:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2901"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-05-21T20:22:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526934121300_1821869931","id":"20180521-202201_811776725","dateCreated":"2018-05-21T20:22:01+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2902"}],"name":"Spark","id":"2DDH9ZRGY","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}