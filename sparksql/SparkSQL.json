{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.window import Window","user":"anonymous","dateUpdated":"2018-05-21T20:24:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934198809_-384756957","id":"20180521-202318_1945694173","dateCreated":"2018-05-21T20:23:18+0000","dateStarted":"2018-05-21T20:24:19+0000","dateFinished":"2018-05-21T20:24:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4769"},{"text":"%pyspark\ndefun = spark.read.csv('s3://daniel-sharp/decesos/defun_2016.csv', header =True) \ncausas = spark.read.csv('s3://daniel-sharp/decesos/decatcausa.csv', header =True) \nestados = spark.read.csv('s3://daniel-sharp/decesos/decateml.CSV', header =True) \ngenero = spark.read.csv('s3://daniel-sharp/decesos/desexo.csv', header =True) \nedad = spark.read.csv('s3://daniel-sharp/decesos/deedad.csv', header =True) ","user":"anonymous","dateUpdated":"2018-05-21T20:24:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934259780_1947514255","id":"20180521-202419_201764952","dateCreated":"2018-05-21T20:24:19+0000","dateStarted":"2018-05-21T20:24:27+0000","dateFinished":"2018-05-21T20:24:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4770"},{"text":"%pyspark\nestados_clean = estados.withColumn('cve_ent', regexp_replace('cve_ent', '\\t', ''))\\\n.withColumn('cve_mun', regexp_replace('cve_mun', '\\t', '')).filter('cve_mun == 000')\ndefun_c = defun.withColumn('ent_ocurr', regexp_replace('ent_ocurr', '\\t', ''))\ngenero = genero.selectExpr(\"DESCRIP as descrip_sexo\", \"CVE as cve_sexo\")\nedad = edad.selectExpr(\"DESCRIP as descrip_edad\", \"CVE as cve_edad\")","user":"anonymous","dateUpdated":"2018-05-21T20:24:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934267252_2001009676","id":"20180521-202427_1403757392","dateCreated":"2018-05-21T20:24:27+0000","dateStarted":"2018-05-21T20:24:50+0000","dateFinished":"2018-05-21T20:24:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4771"},{"text":"%pyspark\nincisoa = defun_c.alias('a').join(causas.alias('b'),col('a.causa_def') == col('b.cve')).join(estados_clean.alias('c'),col('a.ent_ocurr') == col('c.cve_ent'))\\\n.filter((defun_c['causa_def'] == 'B150') | (defun_c['causa_def'] == 'B159')).groupBy('nom_loc').count().sort(desc('count'))\nincisoa.repartition(1).write.csv('s3://daniel-sharp/decesos/sparksql/')","user":"anonymous","dateUpdated":"2018-05-21T20:29:10+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934290048_1753586009","id":"20180521-202450_784971910","dateCreated":"2018-05-21T20:24:50+0000","dateStarted":"2018-05-21T20:29:10+0000","dateFinished":"2018-05-21T20:29:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4772"},{"text":"%pyspark\nincisob = defun_c.alias('a').join(causas.alias('b'),col('a.causa_def') == col('b.cve'))\\\n.join(estados_clean.alias('c'),col('a.ent_ocurr') == col('c.cve_ent'))\\\n.join(genero.alias('d'),col('a.sexo') == col('d.cve_sexo'))\\\n.join(edad.alias('e'),col('a.edad') == col('e.cve_edad'))\\\n.filter(\"descrip_edad like '%Cincuenta y tres años%'\")\\\n.groupBy('nom_loc','DESCRIP','descrip_sexo').count()\\\n.select(\"*\",dense_rank().over(Window.partitionBy('nom_loc', 'descrip_sexo').orderBy(desc('count'))).alias('rn'))\\\n.filter('rn == 6')\nincisob.repartition(1).write.csv('s3://daniel-sharp/decesos/sparksql/b/')","user":"anonymous","dateUpdated":"2018-05-21T20:32:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1526934309854_-217836707","id":"20180521-202509_523660629","dateCreated":"2018-05-21T20:25:09+0000","dateStarted":"2018-05-21T20:32:27+0000","dateFinished":"2018-05-21T20:32:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4773"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-05-21T20:25:36+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526934336329_-350544429","id":"20180521-202536_911633441","dateCreated":"2018-05-21T20:25:36+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:4774"}],"name":"SparkSQL","id":"2DE31ZJES","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}